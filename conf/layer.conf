# We have a conf and classes directory, add to BBPATH
BBPATH .= ":${LAYERDIR}"

# We have recipes-* directories, add to BBFILES
BBFILES += "${LAYERDIR}/recipes-*/*/*.bb \
            ${LAYERDIR}/recipes-*/*/*.bbappend"

BBFILE_COLLECTIONS += "starlingX-layer"
BBFILE_PATTERN_starlingX-layer := "^${LAYERDIR}/"
BBFILE_PRIORITY_starlingX-layer = "5"

DISTRO_FEATURES_append = " x11 opengl"
EXTRA_IMAGE_FEATURES_append = " x11-base"
VIRTUAL-RUNTIME_graphical_init_manager = "lxdm"

# INITRAMFS_IMAGE = "secure-core-image-initramfs"
DISTRO_FEATURES_NATIVE_append += "systemd ima tpm tpm2 efi-secure-boot luks"
DISTRO_FEATURES_append += "systemd ima tpm tpm2 efi-secure-boot luks"
#DISTRO_FEATURES_append += "systemd ima tpm tpm2 efi-secure-boot luks modsign"
MACHINE_FEATURES_NATIVE_append += "efi"
MACHINE_FEATURES_append += "efi"
#PACKAGE_CLASSES = "package_rpm"
#INHERIT += "sign_rpm_ext"

#SECURE_CORE_IMAGE_EXTRA_INSTALL ?= "\
#    packagegroup-efi-secure-boot \
#    packagegroup-tpm \
#    packagegroup-tpm2 \
#    packagegroup-ima \
#    packagegroup-luks \
#    "

# For iso image
#KERNEL_FEATURES += "features/overlayfs/overlayfs.scc"

#INITRAMFS_SCRIPTS = "initramfs-live-boot \
#                     initramfs-live-install \
#		     initramfs-live-install-efi \
#		     "

LAYERDEPENDS_starlingX-layer = "\
	core \
	networking-layer \
	openembedded-layer \
	networking-layer \
	filesystems-layer \
	perl-layer \
	meta-python \
	webserver \
	virtualization-layer \
	cloud-services-layer \
	openstack-layer \
	openstack-aio-deploy-layer \
	openstack-compute-deploy-layer \
	openstack-controller-deploy-layer \
	openstack-qemu-layer \
	openstack-swift-deploy-layer \
	signing-key \
	efi-secure-boot \
	encrypted-storage \
	integrity \
	tpm2 \
	secure-core \
	selinux \
"
#	tpm-layer 

#	openstack-compute-test-config-layer 
##	openstack-controller-test-config-layer 

# This should only be incremented on significant changes that will
# cause compatibility issues with other layers
LAYERVERSION_starlingX-version = "1"
LAYERSERIES_COMPAT_starlingX-layer = "thud"

VIRTUAL-RUNTIME_init_manager = "systemd"
DISTRO_FEATURES_append = " systemd"
DISTRO_FEATURES_BACKFILL_CONSIDERED += "sysvinit"

DISTRO_FEATURES_append = " bluez pam largefile opengl"
DISTRO_FEATURES_append = " virtualization"
DISTRO_FEATURES_append = " openstack"
DISTRO_FEATURES_append = " selinux"
DISTRO_FEATURES_append = " kvm"

PREFERRED_PROVIDER_virtual/containerd = "containerd-opencontainers" 
PREFERRED_PROVIDER_virtual/kernel = "linux-yocto"

PREFERRED_VERSION_keyutils = "1.5.10"

IMAGE_INSTALL_append += " \
	packagegroup-stx-config \
	packagegroup-stx-fault \
	packagegroup-stx-metal \
	packagegroup-stx-ha \
	packagegroup-stx-nfv \
	starlingx-dashboard \
	packagegroup-stx-update \
	packagegroup-stx-upstream \
	packagegroup-stx-integ \
	lighttpd \
	"
#	playbookconfig 

IMAGE_INSTALL_append += " \
	python-oslo.messaging \
	python-horizon \
	python-keyring \
	"

IMAGE_INSTALL_append = " \
	tcpdump \
	tzdata \
	numactl \
	samba \
	mariadb \
	traceroute \
	wget \
	expect \
	boost \
	alsa-lib \
	collectd \
	conntrack-tools \
	dosfstools \
	dracut \
	drbd-utils \
	efibootmgr \
	efivar \
	expat \
	facter \
	hwdata \
	iscsi-initiator-utils \
	isomd5sum \
	jansson \
	json-c \
	kexec-tools \
	keyutils \
	kubernetes \
	libcgroup \
	libdrm \
	libedit \
	libestr \
	libev \
	libgudev \
	libibverbs \
	libjpeg-turbo \
	libndp \
	oath \
	libogg \
	libpcap \
	libpciaccess \
	libpipeline \
	libpng \
	libproxy \
	libpwquality \
	libseccomp \
	libsm \
	libssh2 \
	sysfsutils \
	libteam \
	libuser \
	libutempter \
	libvorbis \
	cyrus-sasl \
	ipmitool \
	iperf3 \
	iotop \
	lsof \
	lsscsi \
	lz4 \
	lzop \
	mailcap \
	mailx \
	mdadm \
	mod-wsgi \
	mokutil \
	mozjs \
	mtools \
	mysql-python \
	libnewt-python \
	nss-pam-ldapd \
	ntfs-3g-ntfsprogs \
	openipmi \
	openldap \
	libopus \
	ovmf-shell-efi \
	p11-kit \
	perf \
	polkit \
	popt \
	pulseaudio \
	python-pygpgme \
	python-pyparted \
	python-coverage \
	python-docker-registry-core \
	python-flask-restful \
	python-mox3 \
	python-pexpect \
	python-ptyprocess \
	python-traceback2 \
	python-typing \
	python-ujson \
	python-yappi \
	python-hp3parclient \
	python-click \
	python-daemon \
	python-ipy \
	python-ldap \
	python-linecache2 \
	python-pep8 \
	python-pyudev \
	python-simplegeneric \
	python-slip-dbus \
	python-pytz \
	python-pymysql \
	python-pyzmq \
	python-xstatic-jquery.tablesorter \
	python-xstatic-jquery.quicksearch \
	ruby-shadow \
	screen \
	seabios \
	smartmontools \
	snappy \
	socat \
	spawn-fcgi \
	spice \
	swig \
	sysstat \
	tcp-wrappers \
	trousers \
	xfsprogs \
	yajl \
	zip \
	c-ares \
	cifs-utils \
	createrepo-c \
	gdbm \
	gmp \
	groff \
	libnl \
	mcstrans \
	linuxptp \
	lua \
	lldpd \
	multipath-tools \
	flac \
	freetype \
	geoip \
	glusterfs \
	gobject-introspection \
	gperftools \
	gpm \
	hiera \
	leveldb \
	libutempter \
	lksctp-tools \
	quota \
	radvd \
	usbredir \
	texinfo \
	freetype \
	celt051 \
	cryptsetup \
	lmsensors-libsensors \
	lmsensors-fancontrol \
	lmsensors-isatools \
	lmsensors-pwmconfig \
	lmsensors-sensord \
	lmsensors-sensors \
	lmsensors-sensorsconfconvert \
	lmsensors-sensorsdetect \
	python-perf \
	python-urwid \
	python-urlgrabber \
	python-semantic-version \
	python-repoze.lru \
	python-pyelftools \
	python-pycurl \
	python-lefthandclient \
	python-jwcrypto \
	python-iniparse \
	python-ethtool \
	python-jmespath \
	python-beaker \
	python-cherrypy \
	python-d2to1 \
	python-firewall \
	python-ldap3 \
	python-pyngus \
	python-jwt \
	python-pyzmq \
	python-requests-oauthlib \
	packagegroup-tpm2 \
	"
##################################################
# Following Packages have conflicts:
# yocto:meta-starlingx
# python-horizon:python-dajango-horizon
# python-sqlalchemy-migrate:python-migrate
# python-pyscss:python-scss


#	python-django-horizon 
#	python-scss 
#	python-migrate

##########
#	tpm2-abrmd
#	tpm2-tss
#	tboot 
#	syslinux 
#	docker-ce 
#	docker-distribution 
#	syslog-ng 
#	drbd 
#	etcd 
#	nss-myhostname
#	rdma-core
#	librdmacm

#	libgdbm6 
##	libgdbm-bin 
#	libgmp10 
#	libgmpxx4 
#	lmsensors
#	lmsensors-config

#	unbound 
